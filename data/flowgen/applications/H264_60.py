import AppComposer

# Make Application
H264 = AppComposer.Application(AppName = "H264_60")

# Make Threads
VideoIn = AppComposer.Thread(ThreadName = "VideoIn")
YUVGenerator = AppComposer.Thread(ThreadName = "YUVGenerator")
ChromaResampler = AppComposer.Thread(ThreadName = "ChromaResampler")
MVPadding = AppComposer.Thread(ThreadName = "MVPadding")
MotionEstimation = AppComposer.Thread(ThreadName = "MotionEstimation")
MotionCompensation = AppComposer.Thread(ThreadName = "MotionCompensation")
EntropyEncoder = AppComposer.Thread(ThreadName = "EntropyEncoder")
DCT = AppComposer.Thread(ThreadName = "DCT")
SampleHold = AppComposer.Thread(ThreadName = "SampleHold")
StreamOut = AppComposer.Thread(ThreadName = "StreamOut")
Quantization = AppComposer.Thread(ThreadName = "Quantization")
DeblockingFilter = AppComposer.Thread(ThreadName = "DeblockingFilter")
IQ = AppComposer.Thread(ThreadName = "IQ")
IDCT = AppComposer.Thread(ThreadName = "IDCT")
Predictor = AppComposer.Thread(ThreadName = "Predictor")

# Add Threads to Applications
H264.addThread(VideoIn)
H264.addThread(YUVGenerator)
H264.addThread(ChromaResampler)
H264.addThread(MVPadding)
H264.addThread(MotionEstimation)
H264.addThread(MotionCompensation)
H264.addThread(EntropyEncoder)
H264.addThread(DCT)
H264.addThread(SampleHold)
H264.addThread(StreamOut)
H264.addThread(Quantization)
H264.addThread(DeblockingFilter)
H264.addThread(IQ)
H264.addThread(IDCT)
H264.addThread(Predictor)

# Add Flows to Threads (Bandwidth parameter must be in Megabytes/second)
VideoIn.addFlow(AppComposer.CBRFlow(TargetThread = YUVGenerator, Bandwidth = 360))
YUVGenerator.addFlow(AppComposer.CBRFlow(TargetThread = MVPadding, Bandwidth = 120))
YUVGenerator.addFlow(AppComposer.CBRFlow(TargetThread = MotionEstimation, Bandwidth = 120))
YUVGenerator.addFlow(AppComposer.CBRFlow(TargetThread = MotionCompensation, Bandwidth = 120))
YUVGenerator.addFlow(AppComposer.CBRFlow(TargetThread = ChromaResampler, Bandwidth = 240))
ChromaResampler.addFlow(AppComposer.CBRFlow(TargetThread = MotionCompensation, Bandwidth = 60))
MVPadding.addFlow(AppComposer.CBRFlow(TargetThread = MotionEstimation, Bandwidth = 85.71))
MotionEstimation.addFlow(AppComposer.CBRFlow(TargetThread = MotionCompensation, Bandwidth = 1.28))
MotionEstimation.addFlow(AppComposer.CBRFlow(TargetThread = EntropyEncoder, Bandwidth = 1.28))
MotionCompensation.addFlow(AppComposer.CBRFlow(TargetThread = DCT, Bandwidth = 180))
MotionCompensation.addFlow(AppComposer.CBRFlow(TargetThread = Predictor, Bandwidth = 180))
EntropyEncoder.addFlow(AppComposer.CBRFlow(TargetThread = StreamOut, Bandwidth = 25.72))
DCT.addFlow(AppComposer.CBRFlow(TargetThread = Quantization, Bandwidth = 90))
SampleHold.addFlow(AppComposer.CBRFlow(TargetThread = MotionCompensation, Bandwidth = 97.71))
Quantization.addFlow(AppComposer.CBRFlow(TargetThread = EntropyEncoder, Bandwidth = 28.28))
Quantization.addFlow(AppComposer.CBRFlow(TargetThread = IQ, Bandwidth = 28.28))
DeblockingFilter.addFlow(AppComposer.CBRFlow(TargetThread = SampleHold, Bandwidth = 97.71))
IQ.addFlow(AppComposer.CBRFlow(TargetThread = IDCT, Bandwidth = 10.28))
IDCT.addFlow(AppComposer.CBRFlow(TargetThread = Predictor, Bandwidth = 10.28))
Predictor.addFlow(AppComposer.CBRFlow(TargetThread = DeblockingFilter, Bandwidth = 94.71))

# Save App to JSON
H264.toJSON(SaveToFile = True, FileName = "H264_60")
